<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/AwesomeKrieger/Geschenk/refs/heads/main/AppIcon%7Eios-marketing.png">

    <title>The Secret Mission ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&display=swap" rel="stylesheet">
    
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; background: #0c4a6e; font-family: 'Inter', sans-serif;
            touch-action: none; overflow: hidden;
        }
        canvas { display: block; width: 100vw; height: 100vh; background: linear-gradient(to bottom, #1e3a8a, #3b82f6); }
        
        .overlay { 
            position: fixed; inset: 0; z-index: 1000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); padding: 20px;
        }
        
        .card { background: white; padding: 30px; border-radius: 40px; text-align: center; max-width: 300px; }
        .btn-trigger { 
            background: #ef4444; color: white; padding: 18px 45px; 
            border-radius: 50px; font-weight: 900; border: none; 
            font-size: 1.2rem; cursor: pointer; margin-top: 20px;
        }

        /* FINALE SCROLL SEKTION */
        #scroll-finale { display: none; width: 100%; background: #fff1f2; position: relative; }
        .word-section { height: 100vh; display: flex; align-items: center; justify-content: center; position: sticky; top: 0; }
        .big-word { 
            font-size: 14vw; font-weight: 900; color: #be123c; 
            opacity: 0; transform: scale(0.8); transition: all 0.5s ease-out; 
            text-transform: uppercase;
        }
        .active { opacity: 1; transform: scale(1.1); }
        
        /* Das Flugzeug im Scroll-Modus */
        #plane-icon { 
            position: fixed; top: 45%; left: -100px; font-size: 60px; 
            z-index: 2000; pointer-events: none; transform: rotate(0deg); 
        }
    </style>
</head>
<body>

    <div id="start-screen" class="overlay">
        <div class="card">
            <h1 class="text-3xl font-black text-blue-900 mb-2">MISSION üîí</h1>
            <p class="text-gray-500 text-sm mb-6">Fliege durch die Skyline bis zum Ziel. <br><b>Anforderung: 25 Punkte</b></p>
            <button class="btn-trigger" onclick="beginGame()">START</button>
        </div>
    </div>

    <div id="fail-screen" class="overlay" style="display: none;">
        <div class="card">
            <h1 class="text-red-600 font-black text-3xl mb-2">CRASH!</h1>
            <button class="btn-trigger" onclick="beginGame()">NOCHMAL</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="scroll-finale">
        <div id="plane-icon">‚úàÔ∏è</div>
        <div class="word-section"><div class="big-word">ICH</div></div>
        <div class="word-section"><div class="big-word">ZAHLE</div></div>
        <div class="word-section"><div class="big-word">DIR</div></div>
        <div class="word-section"><div class="big-word">DEN</div></div>
        <div class="word-section"><div class="big-word">FLUG!</div></div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameRunning = false;
        let score = 0;
        const target = 25;
        const plane = { x: 50, y: 0, w: 40, h: 30, gravity: 0.5, lift: -8, velocity: 0 };
        const pipes = [];
        const pipeWidth = 80;
        const pipeGap = 210;

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        function beginGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('fail-screen').style.display = 'none';
            score = 0; pipes.length = 0;
            plane.y = canvas.height/2; plane.velocity = 0;
            gameRunning = true;
            requestAnimationFrame(loop);
        }

        function drawBuilding(x, y, w, h, isTop) {
            ctx.fillStyle = "#0f172a"; // Dunkle Hochh√§user
            ctx.fillRect(x, y, w, h);
            // Fenster zeichnen
            ctx.fillStyle = "#334155";
            for(let i = x+10; i < x+w-10; i+=20) {
                for(let j = (isTop ? 20 : y+20); j < (isTop ? h-20 : y+h-20); j+=30) {
                    if(Math.random() > 0.3) ctx.fillRect(i, j, 8, 12);
                }
            }
        }

        function loop() {
            if (!gameRunning) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            plane.velocity += plane.gravity;
            plane.y += plane.velocity;
            ctx.font = "40px Arial";
            ctx.fillText("‚úàÔ∏è", plane.x, plane.y);

            if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 300) {
                const top = Math.random() * (canvas.height - pipeGap - 150) + 75;
                pipes.push({ x: canvas.width, top: top, passed: false });
            }

            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= 4;
                
                // Zielflagge statt Haus beim Erreichen des Scores
                if(score >= target && !pipes[i].passed) {
                    ctx.font = "60px Arial";
                    ctx.fillText("üèÅ", pipes[i].x, canvas.height/2);
                } else {
                    drawBuilding(pipes[i].x, 0, pipeWidth, pipes[i].top, true);
                    drawBuilding(pipes[i].x, pipes[i].top + pipeGap, pipeWidth, canvas.height - (pipes[i].top + pipeGap), false);
                }

                if (plane.x + 30 > pipes[i].x && plane.x < pipes[i].x + pipeWidth) {
                    if (score < target && (plane.y - 25 < pipes[i].top || plane.y + 5 > pipes[i].top + pipeGap)) {
                        gameRunning = false; document.getElementById('fail-screen').style.display = 'flex';
                    }
                    if (score >= target) win();
                }

                if (!pipes[i].passed && pipes[i].x < plane.x) {
                    pipes[i].passed = true; score++;
                }
                if (pipes[i].x + pipeWidth < 0) pipes.splice(i, 1);
            }

            ctx.fillStyle = "white"; ctx.font = "900 40px Inter";
            ctx.fillText(Math.min(score, target), canvas.width/2 - 15, 80);
            if (plane.y > canvas.height || plane.y < 0) { gameRunning = false; document.getElementById('fail-screen').style.display = 'flex'; }
            requestAnimationFrame(loop);
        }

        function win() {
            gameRunning = false;
            setTimeout(() => {
                canvas.style.display = 'none';
                const finale = document.getElementById('scroll-finale');
                finale.style.display = 'block';
                // WICHTIG: Seite f√ºr Scrollen freigeben
                document.body.style.overflowY = 'auto';
                document.body.style.height = 'auto';
                document.documentElement.style.overflowY = 'auto';
                window.scrollTo(0, 0);
            }, 500);
        }

        const flap = (e) => { if (gameRunning) { plane.velocity = plane.lift; e.preventDefault(); } };
        window.addEventListener('touchstart', flap, { passive: false });
        window.addEventListener('mousedown', flap);

        window.onscroll = () => {
            const scrollPercent = window.scrollY / (document.body.offsetHeight - window.innerHeight);
            const planeIcon = document.getElementById('plane-icon');
            planeIcon.style.left = (scrollPercent * 130) - 15 + '%';
            
            const words = document.querySelectorAll('.big-word');
            words.forEach((word, i) => {
                const trigger = i / words.length;
                if (scrollPercent > trigger - 0.1) word.classList.add('active');
                else word.classList.remove('active');
            });
        };
    </script>
</body>
</html>
