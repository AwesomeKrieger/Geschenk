<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/AwesomeKrieger/Geschenk/refs/heads/main/AppIcon%7Eios-marketing.png">

    <title>The Secret Mission ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@900&display=swap" rel="stylesheet">
    
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; background: #0c4a6e; font-family: 'Inter', sans-serif;
        }
        canvas { display: block; width: 100vw; height: 100vh; background: linear-gradient(to bottom, #1e3a8a, #3b82f6); }
        
        .overlay { 
            position: fixed; inset: 0; z-index: 1000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); padding: 20px;
        }
        
        .card { background: white; padding: 30px; border-radius: 40px; text-align: center; max-width: 340px; }
        .btn-trigger { 
            background: #ef4444; color: white; padding: 18px 45px; 
            border-radius: 50px; font-weight: 900; border: none; 
            font-size: 1.2rem; cursor: pointer; margin-top: 20px;
            transition: all 0.3s;
        }
        .btn-trigger:disabled {
            background: #9ca3af; cursor: not-allowed; opacity: 0.6;
        }
        
        .countdown { 
            font-size: 2.5rem; font-weight: 900; color: #be123c; 
            margin: 15px 0;
        }
        .countdown-label {
            font-size: 0.9rem; color: #666; margin-bottom: 10px;
        }
        
        .scroll-instruction {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(190, 18, 60, 0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 900;
            font-size: 1.1rem;
            z-index: 3000;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        /* FINALE SCROLL SEKTION */
        #scroll-finale { 
            display: none; 
            width: 100%; 
            min-height: 900vh; 
            background: #fff1f2; 
            position: relative; 
            overflow: hidden;
        }
        .word-section { 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: sticky; 
            top: 0; 
        }
        .big-word { 
            font-size: 14vw; font-weight: 900; color: #be123c; 
            opacity: 0; transform: scale(0.8); transition: all 0.5s ease-out; 
            text-transform: uppercase;
        }
        .active { opacity: 1; transform: scale(1.1); }
        
        /* Das Flugzeug fliegt von oben nach unten, gedreht nach unten */
        #plane-icon { 
            position: fixed; 
            top: -100px; 
            left: 50%; 
            transform: translateX(-50%) rotate(135deg);
            font-size: 30px; 
            z-index: 2000; 
            pointer-events: none; 
            transition: all 0.3s ease-out;
            opacity: 0;
        }
        
        .plane-visible {
            opacity: 1 !important;
        }
        
        /* Herz-Konfetti */
        .heart {
            position: fixed;
            font-size: 30px;
            animation: fall linear forwards;
            z-index: 9999;
            pointer-events: none;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

    <div id="start-screen" class="overlay">
        <div class="card">
            <h1 class="text-3xl font-black text-blue-900 mb-2">MISSION üîí</h1>
            
            <div class="countdown-label">Countdown bis Valentinstag:</div>
            <div class="countdown" id="countdown">L√§dt...</div>
            
            <p class="text-gray-500 text-sm mb-6">Fliege durch die Skyline bis zum Ziel. <br><b>Anforderung: 25 Punkte</b></p>
            <button class="btn-trigger" id="startBtn" onclick="beginGame()" disabled>Warte auf Countdown...</button>
        </div>
    </div>

    <div id="fail-screen" class="overlay" style="display: none;">
        <div class="card">
            <h1 class="text-red-600 font-black text-3xl mb-2">CRASH!</h1>
            <button class="btn-trigger" onclick="beginGame()">NOCHMAL</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="scroll-finale">
        <div class="scroll-instruction">üëá Nach unten scrollen üëá</div>
        <div id="plane-icon">‚úàÔ∏è</div>
        <div class="word-section"><div class="big-word">ICH</div></div>
        <div class="word-section"><div class="big-word">ZAHLE</div></div>
        <div class="word-section"><div class="big-word">DIR</div></div>
        <div class="word-section"><div class="big-word">DEN</div></div>
        <div class="word-section"><div class="big-word">FLUG!</div></div>
        <div class="word-section"><div class="big-word">NICHT</div></div>
        <div class="word-section"><div class="big-word">SPASS</div></div>
        <div class="word-section"><div class="big-word" style="font-size: 9vw;">MIT DEINEN<br>GENANNTEN<br>BEDINGUNGEN<br>HiHi</div></div>
        <div class="word-section"><div class="big-word" style="font-size: 11vw;">ALLES GUTE<br>ZUM<br>VALENTINSTAG!</div></div>
    </div>

    <script>
        let countdownReached = false;
        
        // COUNTDOWN LOGIK
        function updateCountdown() {
            const targetDate = new Date('2026-02-14T10:00:00+01:00'); // 14.2.2026, 10:00 Uhr Deutschland
            const now = new Date();
            const diff = targetDate - now;
            
            if(diff <= 0) {
                document.getElementById('countdown').textContent = 'üéâ JETZT! üéâ';
                if(!countdownReached) {
                    countdownReached = true;
                    const startBtn = document.getElementById('startBtn');
                    startBtn.disabled = false;
                    startBtn.textContent = 'START';
                    startBtn.style.background = '#ef4444';
                }
                return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('countdown').textContent = 
                `${days}T ${hours}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
        }
        
        updateCountdown();
        setInterval(updateCountdown, 1000);

        // HERZ-KONFETTI
        function createHeart() {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.textContent = '‚ù§Ô∏è';
            heart.style.left = Math.random() * 100 + '%';
            heart.style.animationDuration = (Math.random() * 3 + 2) + 's';
            heart.style.fontSize = (Math.random() * 20 + 20) + 'px';
            document.body.appendChild(heart);
            
            setTimeout(() => heart.remove(), 5000);
        }
        
        function startConfetti() {
            for(let i = 0; i < 50; i++) {
                setTimeout(() => createHeart(), i * 100);
            }
            // Kontinuierliches Konfetti
            const interval = setInterval(() => createHeart(), 300);
            setTimeout(() => clearInterval(interval), 10000);
        }

        // SPIEL LOGIK
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameRunning = false;
        let score = 0;
        const target = 25;
        const plane = { x: 50, y: 0, w: 40, h: 30, gravity: 0.5, lift: -8, velocity: 0 };
        const pipes = [];
        const pipeWidth = 80;
        const pipeGap = 210;
        
        // Statische Fenster-Daten pro Geb√§ude
        const buildingWindows = new Map();

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        function beginGame() {
            if(!countdownReached) return;
            
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('fail-screen').style.display = 'none';
            score = 0; pipes.length = 0;
            buildingWindows.clear();
            plane.y = canvas.height/2; plane.velocity = 0;
            gameRunning = true;
            requestAnimationFrame(loop);
        }

        function getOrCreateWindows(buildingId) {
            if(!buildingWindows.has(buildingId)) {
                // Generiere statische Fenster-Daten f√ºr dieses Geb√§ude
                const windows = [];
                for(let i = 10; i < pipeWidth-10; i+=20) {
                    for(let j = 20; j < 500; j+=30) {
                        windows.push({
                            x: i,
                            y: j,
                            visible: Math.random() > 0.3,
                            lit: Math.random() > 0.7
                        });
                    }
                }
                buildingWindows.set(buildingId, windows);
            }
            return buildingWindows.get(buildingId);
        }

        function drawBuilding(x, y, w, h, isTop, buildingId) {
            ctx.fillStyle = "#0f172a"; // Dunkle Hochh√§user
            ctx.fillRect(x, y, w, h);
            
            // Statische Fenster zeichnen
            const windows = getOrCreateWindows(buildingId);
            windows.forEach(win => {
                if(!win.visible) return;
                
                const windowY = isTop ? win.y : y + win.y;
                if(windowY < y || windowY > y + h - 20) return;
                
                ctx.fillStyle = win.lit ? "#fbbf24" : "#334155";
                ctx.fillRect(x + win.x, windowY, 8, 12);
            });
        }

        function loop() {
            if (!gameRunning) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            plane.velocity += plane.gravity;
            plane.y += plane.velocity;
            ctx.font = "40px Arial";
            ctx.fillText("‚úàÔ∏è", plane.x, plane.y);

            if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 300) {
                const top = Math.random() * (canvas.height - pipeGap - 150) + 75;
                const id = Date.now() + Math.random();
                pipes.push({ x: canvas.width, top: top, passed: false, id: id });
            }

            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= 4;
                
                // Zielflagge statt Haus beim Erreichen des Scores
                if(score >= target && !pipes[i].passed) {
                    ctx.font = "60px Arial";
                    ctx.fillText("üèÅ", pipes[i].x, canvas.height/2);
                } else {
                    drawBuilding(pipes[i].x, 0, pipeWidth, pipes[i].top, true, pipes[i].id + '_top');
                    drawBuilding(pipes[i].x, pipes[i].top + pipeGap, pipeWidth, canvas.height - (pipes[i].top + pipeGap), false, pipes[i].id + '_bottom');
                }

                if (plane.x + 30 > pipes[i].x && plane.x < pipes[i].x + pipeWidth) {
                    if (score < target && (plane.y - 25 < pipes[i].top || plane.y + 5 > pipes[i].top + pipeGap)) {
                        gameRunning = false; document.getElementById('fail-screen').style.display = 'flex';
                    }
                    if (score >= target) win();
                }

                if (!pipes[i].passed && pipes[i].x < plane.x) {
                    pipes[i].passed = true; score++;
                }
                if (pipes[i].x + pipeWidth < 0) pipes.splice(i, 1);
            }

            ctx.fillStyle = "white"; ctx.font = "900 40px Inter";
            ctx.fillText(Math.min(score, target), canvas.width/2 - 15, 80);
            if (plane.y > canvas.height || plane.y < 0) { gameRunning = false; document.getElementById('fail-screen').style.display = 'flex'; }
            requestAnimationFrame(loop);
        }

        function win() {
            gameRunning = false;
            setTimeout(() => {
                canvas.style.display = 'none';
                const finale = document.getElementById('scroll-finale');
                finale.style.display = 'block';
                // WICHTIG: Seite f√ºr Scrollen freigeben
                document.body.style.overflowY = 'auto';
                document.body.style.height = 'auto';
                document.documentElement.style.overflowY = 'auto';
                window.scrollTo(0, 0);
            }, 500);
        }

        const flap = (e) => { if (gameRunning) { plane.velocity = plane.lift; e.preventDefault(); } };
        window.addEventListener('touchstart', flap, { passive: false });
        window.addEventListener('mousedown', flap);

        let scrollInstructionHidden = false;
        let confettiStarted = false;

        window.onscroll = () => {
            const scrollPercent = window.scrollY / (document.body.offsetHeight - window.innerHeight);
            const planeIcon = document.getElementById('plane-icon');
            
            // Scroll-Anweisung ausblenden nach etwas Scrollen
            if(!scrollInstructionHidden && window.scrollY > 50) {
                document.querySelector('.scroll-instruction').style.display = 'none';
                scrollInstructionHidden = true;
            }
            
            // Konfetti am Ende starten
            if(!confettiStarted && scrollPercent > 0.85) {
                confettiStarted = true;
                startConfetti();
            }
            
            // Flugzeug erscheint nur zwischen "DEN" und "FLUG" (40% - 60% des Scrolls)
            const planeStartPercent = 0.35;
            const planeEndPercent = 0.55;
            
            if(scrollPercent >= planeStartPercent && scrollPercent <= planeEndPercent) {
                planeIcon.classList.add('plane-visible');
                
                // Relative Position innerhalb des Flugzeug-Bereichs
                const relativePercent = (scrollPercent - planeStartPercent) / (planeEndPercent - planeStartPercent);
                
                // Flugzeug bewegt sich von oben nach unten
                const topPosition = -100 + (relativePercent * (window.innerHeight + 200));
                planeIcon.style.top = topPosition + 'px';
                
                // Flugzeug wird gr√∂√üer w√§hrend es nach unten fliegt
                const size = 30 + (relativePercent * 150); // Von 30px bis 180px
                planeIcon.style.fontSize = size + 'px';
            } else {
                planeIcon.classList.remove('plane-visible');
            }
            
            const words = document.querySelectorAll('.big-word');
            words.forEach((word, i) => {
                const trigger = i / words.length;
                if (scrollPercent > trigger - 0.1) word.classList.add('active');
                else word.classList.remove('active');
            });
        };
    </script>
</body>
</html>